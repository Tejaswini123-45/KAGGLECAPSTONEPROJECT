<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Growth Hub â€” AI Company Builder</title>
    <style>
        :root {
            --bg-1: #080812;
            --bg-2: #0f1020;
            --sidebar-bg: #05050a;
            --neon-a: #7c3aed;
            --neon-b: #06b6d4;
            --muted: #b9c0d6;
            --text: #e6eefb;
            --border: rgba(255, 255, 255, 0.06);
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
            background: var(--bg-1);
            color: var(--text);
            overflow: hidden;
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            flex-shrink: 0;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            gap: 8px;
        }

        .nav-item {
            padding: 12px 16px;
            border-radius: 8px;
            color: var(--muted);
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.03);
            color: white;
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(124, 58, 237, 0.1), transparent);
            color: #a78bfa;
            border-left: 3px solid var(--neon-a);
        }

        /* Main Content */
        .content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
            background: radial-gradient(circle at top right, rgba(124, 58, 237, 0.05), transparent 40%);
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
            height: 100%;
        }

        .section.active {
            display: block;
        }

        h1 {
            font-size: 28px;
            margin: 0 0 10px 0;
        }

        p.subtitle {
            color: var(--muted);
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }

        .placeholder-box {
            height: 300px;
            border: 2px dashed var(--border);
            border-radius: 12px;
            display: grid;
            place-items: center;
            color: var(--muted);
            background: rgba(0, 0, 0, 0.2);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            < !doctype html><html lang="en"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><title>Growth Hub â€” AI Company Builder</title><style> :root {
                --bg-1: #080812;
                --bg-2: #0f1020;
                --sidebar-bg: #05050a;
                --neon-a: #7c3aed;
                --neon-b: #06b6d4;
                --muted: #b9c0d6;
                --text: #e6eefb;
                --border: rgba(255, 255, 255, 0.06);
            }

            html,
            body {
                height: 100%;
                margin: 0;
                font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
                background: var(--bg-1);
                color: var(--text);
                overflow: hidden;
            }

            /* Layout */
            .app-container {
                display: flex;
                height: 100vh;
            }

            /* Sidebar */
            .sidebar {
                width: 260px;
                background: var(--sidebar-bg);
                border-right: 1px solid var(--border);
                display: flex;
                flex-direction: column;
                padding: 20px;
                flex-shrink: 0;
            }

            .logo {
                font-size: 20px;
                font-weight: 700;
                gap: 8px;
            }

            .nav-item {
                padding: 12px 16px;
                border-radius: 8px;
                color: var(--muted);
                text-decoration: none;
                font-size: 14px;
                transition: all 0.2s;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .nav-item:hover {
                background: rgba(255, 255, 255, 0.03);
                color: white;
            }

            .nav-item.active {
                background: linear-gradient(90deg, rgba(124, 58, 237, 0.1), transparent);
                color: #a78bfa;
                border-left: 3px solid var(--neon-a);
            }

            /* Main Content */
            .content {
                flex: 1;
                padding: 40px;
                overflow-y: auto;
                position: relative;
                background: radial-gradient(circle at top right, rgba(124, 58, 237, 0.05), transparent 40%);
            }

            .section {
                display: none;
                animation: fadeIn 0.3s ease;
                height: 100%;
            }

            .section.active {
                display: block;
            }

            h1 {
                font-size: 28px;
                margin: 0 0 10px 0;
            }

            p.subtitle {
                color: var(--muted);
                margin-bottom: 30px;
            }

            .card {
                background: rgba(255, 255, 255, 0.02);
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 24px;
            }

            .placeholder-box {
                height: 300px;
                border: 2px dashed var(--border);
                border-radius: 12px;
                display: grid;
                place-items: center;
                color: var(--muted);
                background: rgba(0, 0, 0, 0.2);
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
    </style>
</head>

<body>

    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <div
                    style="width:32px;height:32px;background:var(--neon-a);border-radius:8px;display:grid;place-items:center;color:white;font-size:18px;">
                    G</div>
                <span>Growth Hub</span>
            </div>

            <div class="nav-links">
                <a class="nav-item active" onclick="showSection('dashboard', this)">
                    <span>ðŸ“Š</span> Dashboard
                </a>
                <a class="nav-item" onclick="showSection('builder', this)">
                    <span>ðŸ”¨</span> Website Builder
                </a>
                <a class="nav-item" onclick="showSection('marketing', this)">
                    <span>ðŸ“¢</span> Marketing & Socials
                </a>
                <a class="nav-item" onclick="showSection('finance', this)">
                    <span>ðŸ’°</span> Finance
                </a>
                <a class="nav-item" onclick="showSection('leads', this)">
                    <span>ðŸ‘¥</span> Leads & Cust Services
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="content">

            <!-- Section: Dashboard -->
            <div id="dashboard" class="section active">
                <h1>Welcome back, Founder! ðŸš€</h1>
                <p class="subtitle">Here's what's happening with your business today.</p>

                <div
                    style="display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:20px; margin-bottom:40px;">
                    <div class="card">
                        <div style="color:var(--muted); font-size:14px; margin-bottom:10px;">Total Revenue</div>
                        <div style="font-size:24px; font-weight:700;">$0.00</div>
                        <div style="color:var(--neon-b); font-size:12px; margin-top:5px;">+0% this month</div>
                    </div>
                    <div class="card">
                        <div style="color:var(--muted); font-size:14px; margin-bottom:10px;">Active Leads</div>
                        <div style="font-size:24px; font-weight:700;">0</div>
                        <div style="color:var(--neon-a); font-size:12px; margin-top:5px;">New prospects</div>
                    </div>
                    <div class="card">
                        <div style="color:var(--muted); font-size:14px; margin-bottom:10px;">Website Status</div>
                        <div style="font-size:24px; font-weight:700;">Draft</div>
                        <div style="color:#fbbf24; font-size:12px; margin-top:5px;">Not published</div>
                    </div>
                </div>

                <div class="card">
                    <h3>Quick Actions</h3>
                    <div style="display:flex; gap:15px; margin-top:15px;">
                        <button onclick="showSection('builder', document.querySelectorAll('.nav-item')[1])"
                            style="background:rgba(255,255,255,0.05); border:1px solid var(--border); color:white; padding:10px 20px; border-radius:8px; cursor:pointer; transition:all 0.2s;">
                            ðŸ”¨ Build Website
                        </button>
                        <button onclick="showSection('marketing', document.querySelectorAll('.nav-item')[2])"
                            style="background:rgba(255,255,255,0.05); border:1px solid var(--border); color:white; padding:10px 20px; border-radius:8px; cursor:pointer; transition:all 0.2s;">
                            ðŸ“¢ Create Post
                        </button>
                    </div>
                </div>
            </div>

            <!-- Section: Website Builder -->
            <div id="builder" class="section">
                <iframe src="/builder" style="width:100%; height:100%; border:none; border-radius:12px;" title="Website Builder"></iframe>
            </div>

            <!-- Section: Marketing -->
            <div id="marketing" class="section">
                <h1>Marketing & Socials ðŸ“¢</h1>
                <p class="subtitle">Generate Instagram posts with AI and schedule them automatically.</p>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <!-- Left: Post Generator -->
                    <div class="card">
                        <h3 style="margin-top:0">ðŸ“¸ Instagram Post Generator</h3>
                        <div style="display:grid; gap:12px;">
                            <div>
                                <label style="display:block; margin-bottom:5px; color:#b9c0d6; font-size:14px;">Topic *</label>
                                <input type="text" id="mktTopic" placeholder="e.g. New Product Launch, Tips for Success"
                                    style="width:100%; padding:10px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:6px;">
                            </div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
                                <div>
                                    <label style="display:block; margin-bottom:5px; color:#b9c0d6; font-size:14px;">Audience</label>
                                    <input type="text" id="mktAudience" placeholder="e.g. Entrepreneurs"
                                        style="width:100%; padding:10px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:6px;">
                                </div>
                                <div>
                                    <label style="display:block; margin-bottom:5px; color:#b9c0d6; font-size:14px;">Tone</label>
                                    <select id="mktTone" style="width:100%; padding:10px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:6px;">
                                        <option>Professional</option>
                                        <option>Casual</option>
                                        <option>Exciting</option>
                                        <option>Witty</option>
                                        <option>Inspirational</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label style="display:block; margin-bottom:5px; color:#b9c0d6; font-size:14px;">Brand Name</label>
                                <input type="text" id="mktBrand" placeholder="Your brand name"
                                    style="width:100%; padding:10px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:6px;">
                            </div>
                            <button id="generateBtn" onclick="generatePost()"
                                style="background:linear-gradient(135deg, var(--neon-a), var(--neon-b)); border:none; color:white; padding:12px; border-radius:6px; cursor:pointer; font-weight:600;">
                                âœ¨ Generate Post
                            </button>
                        </div>
                    </div>

                    <!-- Right: Post Now (FREE) -->
                    <div class="card">
                        <h3 style="margin-top:0">ðŸš€ Post to Instagram (FREE)</h3>
                        <div style="display:grid; gap:12px;">
                            <div style="background:rgba(16,185,129,0.1); border:1px solid rgba(16,185,129,0.3); padding:12px; border-radius:6px;">
                                <p style="margin:0; font-size:13px; color:#10b981;">
                                    âœ… <strong>100% FREE</strong> - No Zapier premium needed!<br>
                                    Uses Instagram's official Graph API
                                </p>
                            </div>
                            <div>
                                <label style="display:block; margin-bottom:5px; color:#b9c0d6; font-size:14px;">Instagram Account</label>
                                <input type="text" id="mktAccount" placeholder="@your_instagram_handle"
                                    style="width:100%; padding:10px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:white; border-radius:6px;">
                            </div>
                            <button id="postNowBtn" onclick="postNow()" disabled
                                style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); color:white; padding:12px; border-radius:6px; cursor:pointer; font-weight:600;">
                                ðŸ“¸ Post Now to Instagram
                            </button>
                            <button onclick="showSetupInstructions()"
                                style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:#a78bfa; padding:10px; border-radius:6px; cursor:pointer; font-weight:500;">
                                ðŸ“– Setup Instructions (FREE API)
                            </button>
                            <p style="font-size:12px; color:#6b7280; margin:0;">
                                ðŸ’¡ Generate a post first, then click "Post Now". Setup required (see instructions).
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Post Preview -->
                <div class="card" style="margin-top:20px;">
                    <h3 style="margin-top:0">ðŸ“± Post Preview</h3>
                    <div id="mktResult" style="display:none;">
                        <div style="display:grid; grid-template-columns: 300px 1fr; gap:20px;">
                            <!-- Image Preview -->
                            <div>
                                <img id="mktImage" src="" alt="Post Image" 
                                    style="width:100%; border-radius:8px; background:#1a1a2e;">
                            </div>
                            <!-- Caption & Hashtags -->
                            <div>
                                <h4 style="margin:0 0 10px 0; color:#a78bfa;">Caption</h4>
                                <p id="mktCaption" style="margin:0 0 15px 0; line-height:1.6;"></p>
                                
                                <h4 style="margin:0 0 10px 0; color:#a78bfa;">Hashtags</h4>
                                <p id="mktHashtags" style="margin:0; color:#06b6d4; word-wrap:break-word;"></p>
                            </div>
                        </div>
                    </div>
                    <div id="mktEmpty" style="text-align:center; padding:40px; color:#6b7280;">
                        Generate a post to see preview here
                    </div>
                </div>

                <!-- Setup Instructions -->
                <div class="card" style="margin-top:20px; background:rgba(124,58,237,0.1);">
                    <h3 style="margin-top:0;">ðŸ”§ Setup Instructions</h3>
                    <ol style="margin:0; padding-left:20px; color:#b9c0d6; line-height:1.8;">
                        <li>Create a <a href="https://zapier.com" target="_blank" style="color:#a78bfa;">Zapier</a> account</li>
                        <li>Create a new Zap with "Webhooks by Zapier" as trigger (Catch Hook)</li>
                        <li>Connect Instagram as the action (Post to Instagram)</li>
                        <li>Copy your webhook URL and set it in your .env file as ZAPIER_WEBHOOK_URL</li>
                        <li>Enter your Instagram handle above and start scheduling!</li>
                    </ol>
                </div>
            </div>

            <!-- Section: Finance -->
            <div id="finance" class="section">
                <h1>Finance Dashboard</h1>
                <p class="subtitle">Track your revenue, expenses, and burn rate.</p>
                <div class="placeholder-box">
                    Finance Module Coming Soon
                </div>
            </div>

            <!-- Section: Leads -->
            <div id="leads" class="section">
                <h1>Leads & Customer Service</h1>
                <p class="subtitle">Manage customer inquiries and CRM.</p>
                <div class="placeholder-box">
                    CRM Module Coming Soon
                </div>
            </div>

        </main>
    </div>

    <!-- Chat Floating Elements -->
    <button class="chat-fab" onclick="toggleChat()" id="chatFab">
        ðŸ’¬
    </button>

    <div class="chat-panel" id="chatPanel">
        <!-- Resize Handles -->
        <div class="resize-handle n"></div>
        <div class="resize-handle e"></div>
        <div class="resize-handle s"></div>
        <div class="resize-handle w"></div>
        <div class="resize-handle ne"></div>
        <div class="resize-handle se"></div>
        <div class="resize-handle sw"></div>
        <div class="resize-handle nw"></div>

        <div class="chat-header" id="chatHeader">
            <div style="font-weight:600;font-size:15px;">Growth Hub â€” AI Advisor</div>
            <div style="margin-left:auto;display:flex;gap:10px;">
                <span style="font-size:12px;color:#4ade80;display:flex;align-items:center;gap:4px;">
                    <span style="width:6px;height:6px;background:#4ade80;border-radius:50%;"></span> Online
                </span>
                <span style="cursor:pointer;opacity:0.6;" onclick="toggleChat()">_</span>
                <span style="cursor:pointer;opacity:0.6;" onclick="toggleChat()">âœ•</span>
            </div>
        </div>
        <div class="chat-body">
            <iframe src="/chatbot.html" title="Chatbot"></iframe>
        </div>
    </div>

    <style>
        /* Chat Floating Elements */
        .chat-fab {
            position: fixed;
            right: 28px;
            bottom: 28px;
            width: 64px;
            height: 64px;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--neon-a), var(--neon-b));
            display: grid;
            place-items: center;
            font-size: 22px;
            color: white;
            cursor: pointer;
            z-index: 10000;
            /* Ensure it's on top of everything */
            border: none;
            box-shadow: 0 18px 50px rgba(124, 58, 237, 0.18);
            transition: transform 0.2s;
        }

        .chat-fab:hover {
            transform: scale(1.05);
        }

        .chat-panel {
            position: fixed;
            right: 28px;
            bottom: 110px;
            width: 420px;
            height: 640px;
            min-width: 300px;
            min-height: 400px;
            border-radius: 12px;
            display: none;
            z-index: 9999;
            /* Just below FAB but above content */
            background: #07070b;
            border: 1px solid rgba(255, 255, 255, 0.03);
            box-shadow: 0 30px 80px rgba(7, 8, 15, 0.7);
            overflow: visible;
            /* Allow handles to be clickable */
        }

        .chat-panel.show {
            display: block;
        }

        .chat-header {
            height: 56px;
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: grab;
            background: rgba(255, 255, 255, 0.02);
            border-bottom: 1px solid var(--border);
            border-radius: 12px 12px 0 0;
        }

        .chat-body {
            height: calc(100% - 56px);
            background: #0b0b12;
            border-radius: 0 0 12px 12px;
            overflow: hidden;
        }

        .chat-body iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }

        /* Resize Handles */
        .resize-handle {
            position: absolute;
            background: transparent;
            z-index: 100;
        }

        .resize-handle.n {
            top: -5px;
            left: 0;
            right: 0;
            height: 10px;
            cursor: ns-resize;
        }

        .resize-handle.s {
            bottom: -5px;
            left: 0;
            right: 0;
            height: 10px;
            cursor: ns-resize;
        }

        .resize-handle.e {
            right: -5px;
            top: 0;
            bottom: 0;
            width: 10px;
            cursor: ew-resize;
        }

        .resize-handle.w {
            left: -5px;
            top: 0;
            bottom: 0;
            width: 10px;
            cursor: ew-resize;
        }

        .resize-handle.ne {
            top: -5px;
            right: -5px;
            width: 15px;
            height: 15px;
            cursor: nesw-resize;
        }

        .resize-handle.nw {
            top: -5px;
            left: -5px;
            width: 15px;
            height: 15px;
            cursor: nwse-resize;
        }

        .resize-handle.se {
            bottom: -5px;
            right: -5px;
            width: 15px;
            height: 15px;
            cursor: nwse-resize;
        }

        .resize-handle.sw {
            bottom: -5px;
            left: -5px;
            width: 15px;
            height: 15px;
            cursor: nesw-resize;
        }
    </style>

    <script>
        // Section Navigation
        function showSection(sectionId, el) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            // Show target
            document.getElementById(sectionId).classList.add('active');

            // Update nav state
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        // Chat Toggle
        const chatPanel = document.getElementById('chatPanel');
        const chatFab = document.getElementById('chatFab');

        function toggleChat() {
            chatPanel.classList.toggle('show');
        }

        // Draggable Logic
        const header = document.getElementById('chatHeader');
        let isDragging = false;
        let startX, startY, initialLeft, initialTop;

        header.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;

            const rect = chatPanel.getBoundingClientRect();
            initialLeft = rect.left;
            initialTop = rect.top;

            // Remove bottom/right positioning to allow absolute top/left movement
            chatPanel.style.right = 'auto';
            chatPanel.style.bottom = 'auto';
            chatPanel.style.left = initialLeft + 'px';
            chatPanel.style.top = initialTop + 'px';

            document.addEventListener('mousemove', onDrag);
            document.addEventListener('mouseup', stopDrag);
        });

        function onDrag(e) {
            if (!isDragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            chatPanel.style.left = (initialLeft + dx) + 'px';
            chatPanel.style.top = (initialTop + dy) + 'px';
        }

        function stopDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('mouseup', stopDrag);
        }

        // Resizable Logic
        const handles = document.querySelectorAll('.resize-handle');

        handles.forEach(handle => {
            handle.addEventListener('mousedown', (e) => {
                e.preventDefault();
                e.stopPropagation();

                const direction = handle.className.split(' ')[1];
                const rect = chatPanel.getBoundingClientRect();
                const startX = e.clientX;
                const startY = e.clientY;
                const startWidth = rect.width;
                const startHeight = rect.height;
                const startTop = rect.top;
                const startLeft = rect.left;

                // Ensure we are in absolute positioning mode for top/left
                chatPanel.style.right = 'auto';
                chatPanel.style.bottom = 'auto';
                chatPanel.style.left = startLeft + 'px';
                chatPanel.style.top = startTop + 'px';
                chatPanel.style.width = startWidth + 'px';
                chatPanel.style.height = startHeight + 'px';

                function onResize(e) {
                    const dx = e.clientX - startX;
                    const dy = e.clientY - startY;

                    if (direction.includes('e')) {
                        chatPanel.style.width = Math.max(300, startWidth + dx) + 'px';
                    }
                    if (direction.includes('s')) {
                        chatPanel.style.height = Math.max(400, startHeight + dy) + 'px';
                    }
                    if (direction.includes('w')) {
                        const newWidth = Math.max(300, startWidth - dx);
                        chatPanel.style.width = newWidth + 'px';
                        chatPanel.style.left = (startLeft + (startWidth - newWidth)) + 'px';
                    }
                    if (direction.includes('n')) {
                        const newHeight = Math.max(400, startHeight - dy);
                        chatPanel.style.height = newHeight + 'px';
                        chatPanel.style.top = (startTop + (startHeight - newHeight)) + 'px';
                    }
                }

                function stopResize() {
                    document.removeEventListener('mousemove', onResize);
                    document.removeEventListener('mouseup', stopResize);
                }

                document.addEventListener('mousemove', onResize);
                document.addEventListener('mouseup', stopResize);
            });
        });

        // Marketing Logic
        let currentPost = null;

        async function generatePost() {
            const btn = document.getElementById('generateBtn');
            const postNowBtn = document.getElementById('postNowBtn');
            const resultDiv = document.getElementById('mktResult');
            const emptyDiv = document.getElementById('mktEmpty');

            const topic = document.getElementById('mktTopic').value;
            const audience = document.getElementById('mktAudience').value || 'General audience';
            const tone = document.getElementById('mktTone').value;
            const brand = document.getElementById('mktBrand').value || 'GrowthHub';

            if (!topic) { alert('Please enter a topic'); return; }

            btn.disabled = true;
            btn.innerHTML = 'â³ Generating...';

            try {
                const res = await fetch('/marketing/generate-post', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic, audience, tone, brand })
                });

                const data = await res.json();
                if (data.status === 'success' && data.result) {
                    currentPost = data.result;
                    
                    // Update preview
                    document.getElementById('mktCaption').textContent = currentPost.caption || '';
                    document.getElementById('mktHashtags').textContent = 
                        (currentPost.hashtags || []).map(h => '#' + h.replace('#', '')).join(' ');
                    
                    // Set image with error handling
                    const imgElement = document.getElementById('mktImage');
                    imgElement.onerror = function() {
                        this.src = 'https://via.placeholder.com/300x300/7c3aed/ffffff?text=Image+Generated';
                    };
                    imgElement.src = currentPost.image_url || 'https://via.placeholder.com/300x300?text=Post+Image';
                    
                    resultDiv.style.display = 'block';
                    emptyDiv.style.display = 'none';
                    
                    // Enable post now button
                    if (postNowBtn) {
                        postNowBtn.disabled = false;
                        postNowBtn.style.background = 'linear-gradient(135deg, var(--neon-a), var(--neon-b))';
                        postNowBtn.style.cursor = 'pointer';
                    }
                } else {
                    alert('Error: ' + (data.message || 'Failed to generate'));
                }
            } catch (e) {
                alert('Error generating post: ' + e.message);
                console.error(e);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'âœ¨ Generate Post';
            }
        }

        async function postNow() {
            if (!currentPost) {
                alert('Please generate a post first');
                return;
            }

            const account = document.getElementById('mktAccount').value;
            if (!account) {
                alert('Please enter your Instagram account handle (e.g., @yourhandle)');
                return;
            }

            const postNowBtn = document.getElementById('postNowBtn');
            postNowBtn.disabled = true;
            postNowBtn.innerHTML = 'â³ Posting...';

            try {
                const res = await fetch('/marketing/post-now', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        post: currentPost,
                        instagram_account: account
                    })
                });

                const data = await res.json();
                if (data.status === 'success') {
                    alert(`âœ… Posted to Instagram!\n\nAccount: ${account}\n\nCheck your Instagram profile to see the post.`);
                } else {
                    alert('Error: ' + (data.result?.message || data.message || 'Failed to post. Make sure you have configured Instagram credentials in .env file.'));
                }
            } catch (e) {
                alert('Error posting: ' + e.message);
                console.error(e);
            } finally {
                postNowBtn.disabled = false;
                postNowBtn.innerHTML = 'ðŸ“¸ Post Now to Instagram';
            }
        }

        async function showSetupInstructions() {
            try {
                const res = await fetch('/marketing/setup');
                const data = await res.json();
                
                let instructions = `${data.title}\n\n`;
                data.steps.forEach(step => {
                    instructions += `${step.step}. ${step.title}\n   ${step.description}\n\n`;
                });
                instructions += '\nNOTES:\n';
                data.notes.forEach(note => {
                    instructions += `${note}\n`;
                });
                
                alert(instructions);
            } catch (e) {
                alert('See INSTAGRAM_SETUP.md file for complete instructions');
            }
        }
    </script>
</body>

</html>